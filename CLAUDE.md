# CLAUDE.md

μ΄ νμΌμ€ Claude Code (claude.ai/code)κ°€ μ΄ μ €μ¥μ†μ—μ„ μ‘μ—…ν•  λ• μ°Έκ³ ν•λ” κ°€μ΄λ“μ…λ‹λ‹¤.

## ν”„λ΅μ νΈ κ°μ”

Spring Bootλ¥Ό μ‚¬μ©ν• ν¬μΈνΈ κ΄€λ¦¬ μ‹μ¤ν…μ„ TDD(Test-Driven Development)λ΅ κµ¬ν„ν•λ” μ‹¤μµ ν”„λ΅μ νΈμ…λ‹λ‹¤. Gradleκ³Ό Java 17μ„ μ‚¬μ©ν•©λ‹λ‹¤.

## λΉλ“ λ° ν…μ¤νΈ λ…λ Ήμ–΄

```bash
# λ¨λ“  ν…μ¤νΈ μ‹¤ν–‰
./gradlew test

# νΉμ • ν…μ¤νΈ ν΄λμ¤ μ‹¤ν–‰
./gradlew test --tests PointServiceTest

# νΉμ • ν…μ¤νΈ λ©”μ„λ“ μ‹¤ν–‰
./gradlew test --tests PointServiceTest.ν¬μΈνΈ_μ¶©μ „_μ„±κ³µ

# ν”„λ΅μ νΈ λΉλ“
./gradlew build

# μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰
./gradlew bootRun

# ν΄λ¦° λΉλ“
./gradlew clean build
```

## μ•„ν‚¤ν…μ²

### κ³„μΈµ κµ¬μ΅°
- **Controller κ³„μΈµ** (`io.hhplus.tdd.point.PointController`): REST API μ—”λ“ν¬μΈνΈ
- **Service κ³„μΈµ** (`io.hhplus.tdd.point.PointService`): λΉ„μ¦λ‹μ¤ λ΅μ§ (ν„μ¬ λΉ„μ–΄μμ, κµ¬ν„ ν•„μ”)
- **Database κ³„μΈµ** (`io.hhplus.tdd.database.*`): μ§€μ—° μ‹κ°„μ΄ μ‹λ®¬λ μ΄μ…λ μΈλ©”λ¨λ¦¬ μ €μ¥μ†

### μ£Όμ” μ»΄ν¬λ„νΈ

**Database Tables (μ λ€ μμ • κΈμ§€)**
- `UserPointTable`: μ‚¬μ©μ ν¬μΈνΈλ¥Ό μ €μ¥ν•λ” μΈλ©”λ¨λ¦¬ μ €μ¥μ†. `selectById()`μ™€ `insertOrUpdate()` λ©”μ„λ“ μ κ³µ
- `PointHistoryTable`: ν¬μΈνΈ κ±°λ λ‚΄μ—­μ„ μ €μ¥ν•λ” μΈλ©”λ¨λ¦¬ μ €μ¥μ†. `insert()`μ™€ `selectAllByUserId()` λ©”μ„λ“ μ κ³µ
- λ‘ ν…μ΄λΈ” λ¨λ‘ μ‹¤μ  λ°μ΄ν„°λ² μ΄μ¤ μ§€μ—°μ„ μ‹λ®¬λ μ΄μ…ν•κΈ° μ„ν• throttling(200-300ms λλ¤ μ§€μ—°) ν¬ν•¨

**λ„λ©”μΈ λ¨λΈ**
- `UserPoint`: `id`, `point`, `updateMillis`λ¥Ό ν¬ν•¨ν•λ” Record ν΄λμ¤
- `PointHistory`: κ±°λ λ‚΄μ—­ μ •λ³΄λ¥Ό ν¬ν•¨ν•λ” Record ν΄λμ¤
- `TransactionType`: `CHARGE`(μ¶©μ „)μ™€ `USE`(μ‚¬μ©) κ°’μ„ κ°€μ§„ Enum

**μ—λ¬ μ²λ¦¬**
- `ApiControllerAdvice`: μ „μ—­ μμ™Έ ν•Έλ“¤λ¬λ΅ 500 μƒνƒμ™€ μ—λ¬ λ©”μ‹μ§€ λ°ν™

### κµ¬ν„ν•΄μ•Ό ν•  API μ—”λ“ν¬μΈνΈ

```
GET    /point/{id}           - μ‚¬μ©μ ν¬μΈνΈ μ”μ•΅ μ΅°ν
GET    /point/{id}/histories - μ‚¬μ©μ ν¬μΈνΈ κ±°λ λ‚΄μ—­ μ΅°ν
PATCH  /point/{id}/charge    - ν¬μΈνΈ μ¶©μ „ (body: amountλ¥Ό long νƒ€μ…μΌλ΅)
PATCH  /point/{id}/use       - ν¬μΈνΈ μ‚¬μ© (body: amountλ¥Ό long νƒ€μ…μΌλ΅)
```

## TDD μ‘μ—… νλ¦„

μ΄ ν”„λ΅μ νΈλ” ν…μ¤νΈ μ£Όλ„ κ°λ°(TDD)μ„ λ”°λ¦…λ‹λ‹¤:

1. **Red**: `src/test/java/io/hhplus/tdd/point/`μ— μ‹¤ν¨ν•λ” ν…μ¤νΈλ¥Ό λ¨Όμ € μ‘μ„±
2. **Green**: ν…μ¤νΈλ¥Ό ν†µκ³Όμ‹ν‚¤κΈ° μ„ν• μµμ†ν•μ μ½”λ“λ¥Ό `PointService`μ— κµ¬ν„
3. **Refactor**: ν…μ¤νΈκ°€ ν†µκ³Όν•λ” μƒνƒλ¥Ό μ μ§€ν•λ©° μ½”λ“ κ°μ„ 

### ν…μ¤νΈ κµ¬μ΅°
- `PointServiceTest`: λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ„ν• λ‹¨μ„ ν…μ¤νΈ (μ£Όμ” μ΄μ )
- `PointControllerTest`: API μ—”λ“ν¬μΈνΈλ¥Ό μ„ν• ν†µν•© ν…μ¤νΈ (μ„ νƒμ‚¬ν•­)

### JaCoCo μ»¤λ²„λ¦¬μ§€

ν”„λ΅μ νΈμ— JaCoCo μ½”λ“ μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬ν…μ΄ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤. ν…μ¤νΈ μ‹¤ν–‰ ν›„ μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬νΈκ°€ μƒμ„±λ©λ‹λ‹¤.

## κµ¬ν„ μ‹ μ μμ‚¬ν•­

- `PointService` ν΄λμ¤λ” λΉ„μ–΄μμΌλ©° κµ¬ν„μ΄ ν•„μ”ν•©λ‹λ‹¤
- Controller λ©”μ„λ“λ“¤μ€ ν„μ¬ λ”λ―Έ λ°μ΄ν„°λ¥Ό λ°ν™ν•κ³  μμΌλ©° `PointService`μ™€ ν†µν•©μ΄ ν•„μ”ν•©λ‹λ‹¤
- μ κ³µλ Table ν΄λμ¤λ“¤μ€ κ³µκ°λ APIλ§ μ‚¬μ©ν•΄μ•Ό ν•©λ‹λ‹¤
- μ‹λ®¬λ μ΄μ…λ λ°μ΄ν„°λ² μ΄μ¤ μ§€μ—°μΌλ΅ μΈν• λ™μ‹μ„± λ¬Έμ λ¥Ό κ³ λ ¤ν•΄μ•Ό ν•©λ‹λ‹¤

## μ½”λ”© μ»¨λ²¤μ…

### Java λ„¤μ΄λ° κ·μΉ™
- **ν΄λμ¤**: PascalCase (μ: `PointService`, `UserPoint`)
- **λ©”μ„λ“/λ³€μ**: camelCase (μ: `chargePoint`, `userId`)
- **μƒμ**: UPPER_SNAKE_CASE (μ: `MIN_POINT_AMOUNT`, `MAX_CHARGE_LIMIT`)
- **ν¨ν‚¤μ§€**: μ†λ¬Έμ (μ: `io.hhplus.tdd.point`)

### ν…μ¤νΈ λ„¤μ΄λ°
- **ν•μ‹**: `{ν…μ¤νΈλ€μƒ}_{μƒν™©}_{κΈ°λ€κ²°κ³Ό}`
- **ν•κΈ€ ν—μ©**: ν…μ¤νΈμ μλ„λ¥Ό λ…ν™•ν μ „λ‹¬ν•κΈ° μ„ν•΄ ν•κΈ€ μ‚¬μ© κ¶μ¥
- **μμ‹**:
  - `ν¬μΈνΈ_μ¶©μ „_μ„±κ³µ`
  - `μμ_κΈμ•΅_μ¶©μ „μ‹_μμ™Έλ°μƒ`
  - `μ”μ•΅λ¶€μ΅±μ‹_ν¬μΈνΈ_μ‚¬μ©_μ‹¤ν¨`
  - `λ™μ‹μ—_100λ…μ΄_μ¶©μ „ν•΄λ„_μ •ν™•ν•_μ”μ•΅_μ μ§€`

### ν…μ¤νΈ κµ¬μ΅°
- **Given-When-Then ν¨ν„΄ μ‚¬μ©**:
  ```java
  @Test
  void ν¬μΈνΈ_μ¶©μ „_μ„±κ³µ() {
      // given: ν…μ¤νΈ μ¤€λΉ„ (μ΄κΈ° μƒνƒ μ„¤μ •)
      long userId = 1L;
      long chargeAmount = 1000L;

      // when: ν…μ¤νΈ μ‹¤ν–‰ (μ‹¤μ  λ™μ‘)
      UserPoint result = pointService.charge(userId, chargeAmount);

      // then: κ²€μ¦ (κΈ°λ€ κ²°κ³Ό ν™•μΈ)
      assertThat(result.point()).isEqualTo(1000L);
  }
  ```
- **ν• ν…μ¤νΈλ” ν• κ°€μ§€λ§ κ²€μ¦**: μ—¬λ¬ κ²€μ¦μ΄ ν•„μ”ν•λ©΄ ν…μ¤νΈλ¥Ό λ¶„λ¦¬
- **AssertJ μ‚¬μ©**: `assertThat()` μ¤νƒ€μΌ μ„ νΈ

### Spring Boot κ³„μΈµλ³„ μ±…μ„
- **Controller**:
  - HTTP μ”μ²­/μ‘λ‹µ μ²λ¦¬λ§
  - λΉ„μ¦λ‹μ¤ λ΅μ§ ν¬ν•¨ κΈμ§€
  - μ„λΉ„μ¤ κ³„μΈµ νΈμ¶ ν›„ κ²°κ³Ό λ°ν™
- **Service**:
  - λ¨λ“  λΉ„μ¦λ‹μ¤ λ΅μ§ μ„μΉ
  - μ…λ ¥κ°’ κ²€μ¦
  - νΈλμ­μ… κ΄€λ¦¬
  - λ™μ‹μ„± μ μ–΄
- **λ„λ©”μΈ λ¨λΈ**:
  - λ¶λ³€μ„± μ μ§€ (Record ν΄λμ¤ ν™μ©)
  - λΉ„μ¦λ‹μ¤ κ·μΉ™ μΊ΅μν™”

### μμ™Έ μ²λ¦¬
- **λΉ„μ¦λ‹μ¤ κ·μΉ™ μ„λ°**: `IllegalArgumentException` μ‚¬μ©
- **μμ™Έ λ©”μ‹μ§€**: κµ¬μ²΄μ μ΄κ³  λ…ν™•ν•κ² μ‘μ„±
  - β "Invalid input"
  - β… "μ¶©μ „ κΈμ•΅μ€ 0λ³΄λ‹¤ μ»¤μ•Ό ν•©λ‹λ‹¤. μ…λ ¥κ°’: -1000"
- **μμ™Έλ” λΉ λ¥΄κ²**: Early Return, Guard Clause ν™μ©

### μ£Όμ„ μ‘μ„±
- **JavaDoc**: public λ©”μ„λ“μ—λ§ μ‘μ„± (μ„ νƒμ )
- **κµ¬ν„ μ£Όμ„**: "λ¬΄μ—‡μ„" λ³΄λ‹¤ "μ™"λ¥Ό μ„¤λ…
  - β `// userIdλ΅ ν¬μΈνΈ μ΅°ν`
  - β… `// λ™μ‹μ„± μ μ–΄λ¥Ό μ„ν•΄ userId κΈ°μ¤€μΌλ΅ λ½ νλ“`
- **λ¶ν•„μ”ν• μ£Όμ„ μ§€μ–‘**: μ½”λ“ μμ²΄κ°€ λ…ν™•ν•λ©΄ μ£Όμ„ λ¶ν•„μ”

### λ™μ‹μ„± μ μ–΄
- **Critical Section μµμ†ν™”**: synchronized λΈ”λ΅ λ²”μ„λ¥Ό μµμ†ν•μΌλ΅
- **Lock κ°μ²΄ λ¶„λ¦¬**: μ‚¬μ©μλ³„ Lock μ‚¬μ© κ³ λ ¤
- **λ°λ“λ½ λ°©μ§€**: Lock νλ“ μμ„ μΌκ΄€μ„± μ μ§€

## Git μ»¤λ°‹ λ©”μ‹μ§€ μ»¨λ²¤μ…

### μ»¤λ°‹ λ©”μ‹μ§€ κµ¬μ΅°
```
{νƒ€μ…}: {μ λ©} (50μ μ΄λ‚΄)

- {κµ¬μ²΄μ μΈ λ³€κ²½μ‚¬ν•­ 1}
- {κµ¬μ²΄μ μΈ λ³€κ²½μ‚¬ν•­ 2}
- {κµ¬μ²΄μ μΈ λ³€κ²½μ‚¬ν•­ 3}
```

### μ»¤λ°‹ νƒ€μ…
- **feat**: μƒλ΅μ΄ κΈ°λ¥ μ¶”κ°€
- **fix**: λ²„κ·Έ μμ •
- **refactor**: λ¦¬ν©ν† λ§ (κΈ°λ¥ λ³€κ²½ μ—†μ)
- **test**: ν…μ¤νΈ μ½”λ“ μ¶”κ°€/μμ •
- **docs**: λ¬Έμ„ μμ • (README, μ£Όμ„, λ¶„μ„ λ¬Έμ„ λ“±)
- **style**: μ½”λ“ ν¬λ§·ν…, μ„Έλ―Έμ½λ΅  μ¶”κ°€ λ“±
- **chore**: λΉλ“ μ„¤μ •, ν¨ν‚¤μ§€ λ§¤λ‹μ € μ„¤μ • λ“±

### μΆ‹μ€ μ»¤λ°‹ λ©”μ‹μ§€ μμ‹
```
feat: ν¬μΈνΈ μ¶©μ „ API κµ¬ν„

- PointService.charge() λ©”μ„λ“ μ¶”κ°€
- μ¶©μ „ κΈμ•΅ μ–‘μ κ²€μ¦ λ΅μ§ ν¬ν•¨
- UserPointTable μ—…λ°μ΄νΈ λ° νμ¤ν† λ¦¬ κΈ°λ΅
- PointControllerμ— μ„λΉ„μ¤ μ—°λ™
```

```
test: λ™μ‹μ„± ν¬μΈνΈ μ¶©μ „ ν…μ¤νΈ μ¶”κ°€

- 100λ…μ΄ λ™μ‹μ— 1000μ›μ”© μ¶©μ „ν•λ” μ‹λ‚λ¦¬μ¤
- CountDownLatchλ΅ λ™μ‹ μ‹¤ν–‰ λ³΄μ¥
- μµμΆ… μ”μ•΅ 100,000μ› κ²€μ¦
```

```
refactor: ν¬μΈνΈ κ²€μ¦ λ΅μ§μ„ λ³„λ„ λ©”μ„λ“λ΅ λ¶„λ¦¬

- validateAmount() λ©”μ„λ“ μ¶”μ¶
- μ¤‘λ³µ κ²€μ¦ μ½”λ“ μ κ±°
- ν…μ¤νΈ ν†µκ³Ό μ μ§€
```

### λ‚μ μ»¤λ°‹ λ©”μ‹μ§€ μμ‹
β "update code"
β "fix bug"
β "μ½”λ“ μμ •"
β "ν…μ¤νΈ μ¶”κ°€ν•¨"
β "WIP"

### TDD μ‘μ—… μ‹ μ»¤λ°‹ ν¨ν„΄
1. **Red λ‹¨κ³„**:
   ```
   test: {κΈ°λ¥λ…} ν…μ¤νΈ μΌ€μ΄μ¤ μ‘μ„±

   - {ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ 1}
   - {ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ 2}
   - ν„μ¬ ν…μ¤νΈ μ‹¤ν¨ (Red λ‹¨κ³„)
   ```

2. **Green λ‹¨κ³„**:
   ```
   feat: {κΈ°λ¥λ…} κµ¬ν„

   - {κµ¬ν„ν• λ΅μ§ μ„¤λ…}
   - λ¨λ“  ν…μ¤νΈ ν†µκ³Ό ν™•μΈ
   ```

3. **Refactor λ‹¨κ³„**:
   ```
   refactor: {λ€μƒ} λ¦¬ν©ν† λ§

   - {κ°μ„  μ‚¬ν•­}
   - κΈ°λ¥ λ™μ‘ μ μ§€, ν…μ¤νΈ ν†µκ³Ό
   ```

### μ»¤λ°‹ μ›μΉ™
- **κµ¬μ²΄μ μΌλ΅**: λ¬΄μ—‡μ„ μ™ λ³€κ²½ν–λ”μ§€ λ…ν™•ν
- **κΉ”λ”ν•κ²**: AI λ„κµ¬ μ‚¬μ© ν”μ  λ‚¨κΈ°μ§€ μ•κΈ°
  - "π¤– Generated with Claude Code" μ¶”κ°€ κΈμ§€
  - "Co-Authored-By: Claude" μ¶”κ°€ κΈμ§€
- **μΌκ΄€μ„±**: ν•κΈ€/μμ–΄ μ¤νƒ€μΌμ„ ν”„λ΅μ νΈ μ „μ²΄μ—μ„ μΌκ΄€λκ² μ μ§€
- **μ›μμ„±**: ν•λ‚μ μ»¤λ°‹μ€ ν•λ‚μ λ…Όλ¦¬μ  λ³€κ²½μ‚¬ν•­λ§ ν¬ν•¨

### μ»¤λ°‹ μ μ™Έ νμΌ
- `.env`, `.env.local` - ν™κ²½ λ³€μ
- `credentials.json`, `secrets.yaml` - λ―Όκ° μ •λ³΄
- `.DS_Store`, `Thumbs.db` - OS μƒμ„± νμΌ
- `*.log` - λ΅κ·Έ νμΌ
- `.idea/`, `.vscode/` - IDE μ„¤μ • (κ³µμ  μ„¤μ • μ μ™Έ)

## μ‚¬μ© κ°€λ¥ν• μ»¤μ¤ν…€ λ…λ Ήμ–΄

ν”„λ΅μ νΈμ—λ” μ‘μ—…μ„ μλ™ν™”ν•λ” μ»¤μ¤ν…€ λ…λ Ήμ–΄λ“¤μ΄ μμµλ‹λ‹¤:

### TDD κ΄€λ ¨
- `/tdd-red` - μ‹¤ν¨ν•λ” ν…μ¤νΈ μ‘μ„± (Red λ‹¨κ³„)
- `/tdd-green` - ν…μ¤νΈ ν†µκ³Ό μµμ† μ½”λ“ μ‘μ„± (Green λ‹¨κ³„)
- `/tdd-refactor` - λ¦¬ν©ν† λ§ μ μ• λ° μ‹¤ν–‰ (Refactor λ‹¨κ³„)
- `/tdd-full` - Red β†’ Green β†’ Refactor μ „μ²΄ μ‚¬μ΄ν΄ μ‹¤ν–‰

### Git κ΄€λ ¨
- `/commit` - λ³€κ²½μ‚¬ν•­ λ¶„μ„ ν›„ κµ¬μ²΄μ μΈ μ»¤λ°‹ λ©”μ‹μ§€ μ‘μ„± λ° μ»¤λ°‹
